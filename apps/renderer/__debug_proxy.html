<!doctype html>
<html>
  <head>
    <script type="module">
      import RefreshRuntime from "https://localhost:2233/@react-refresh"
      RefreshRuntime.injectIntoGlobalHook(window)
      window.$RefreshReg$ = () => {}
      window.$RefreshSig$ = () => (type) => type
      window.__vite_plugin_react_preamble_installed__ = true
    </script>

    <title>Debug Proxy</title>
    <script type="module">
      const host = "https://localhost:2233"

      globalThis["__DEBUG_PROXY__"] = true

      fetch(`${host}`)
        .then((res) => res.text())
        .then((html) => {
          const parser = new DOMParser()
          const doc = parser.parseFromString(html, "text/html")

          const scripts = doc.querySelectorAll("script")

          scripts.forEach((script) => {
            script.remove()
          })

          // header meta

          const $meta = doc.head.querySelectorAll("meta")
          $meta.forEach((meta) => {
            document.head.appendChild(meta)
          })

          const $style = doc.head.querySelectorAll("style")
          $style.forEach((style) => {
            document.head.appendChild(style)
          })

          document.body.innerHTML = doc.body.innerHTML

          scripts.forEach((script) => {
            const $script = document.createElement("script")
            $script.type = "module"
            $script.crossOrigin = script.crossOrigin

            if (script.src) {
              console.log(script.src)
              $script.src = script.src.startsWith("/") ? `${host}${script.src}` : script.src
            } else if (script.innerHTML) {
              $script.innerHTML = script.innerHTML
            } else {
              return
            }

            document.body.appendChild($script)
          })
        })
    </script>
  </head>
  <body></body>
</html>
